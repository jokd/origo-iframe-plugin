<!DOCTYPE html>
<html lang="sv">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge;chrome=1">
	<title>Origo iframe exempel</title>
	<style>
		html, body {
			width: 100vw;
			height: 100vh;
			margin: 0;
		}
		body {
			display: flex;
			align-items: center;
			justify-content: space-around;
		}
		select {
			height: 480px;
		}
	</style>
</head>
<body>
<select multiple></select>
<iframe width="640" height="480" src="/demoksd/embedded/index.html"></iframe>
<script type="text/javascript">
	const selectEl = document.getElementsByTagName("select")[0];
	const iframeEl = document.getElementsByTagName("iframe")[0];

	function sendMessage(command, payload) {
		//console.log("send message");
		iframeEl.contentWindow.postMessage(`${command}:${payload}`, window.origin);
	}

	fetch('https://gi.karlstad.se/geoserver/wfs?SERVICE=WFS&VERSION=1.1.1&REQUEST=GetFeature&OUTPUTFORMAT=application/json&TYPENAMES=webbkartan:vy_webbkarta_na_np_parker')
			.then((res) => res.json())
			.then((res) => {
				res.features.forEach((f) => {
					selectEl.add(new Option(f.properties.itstitle, f.properties.itsid));
				});
			});
	selectEl.addEventListener("input", (e) => {
		//console.log(...e.target.options);
		const selected = [...e.target.options].filter((o) => o.selected);
		sendMessage('setVisibleIDs', selected.map((o) => o.value).join(','));
		sendMessage('zoomTo', selected[selected.length - 1].value);
	});
</script>
</body>
</html>
